package cse213.tableformatsec1;

import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.scene.control.*;

import java.time.LocalDate;

public class TableFor1 {

    @FXML private TextField PriceTextField;
    @FXML private TextField PakageNameTextField;
    @FXML private TextField DataAmountTextField;
    @FXML private ComboBox<String> AvailabilityComboBox;
    @FXML private ComboBox<String> ValidatyComboBox;
    @FXML private DatePicker OfferEndsDP;
    @FXML private TableView<PackageData> TableViewC;
    @FXML private Label ShowMassageLebal;

    @FXML private TableColumn<PackageData, String> packageNameColumn;
    @FXML private TableColumn<PackageData, String> dataAmountColumn;
    @FXML private TableColumn<PackageData, String> validityColumn;
    @FXML private TableColumn<PackageData, String> priceColumn;
    @FXML private TableColumn<PackageData, String> availabilityColumn;
    @FXML private TableColumn<PackageData, String> offerEndsColumn;

    private ObservableList<PackageData> packageList =
            FXCollections.observableArrayList();

    @FXML
    public void initialize() {

        // ComboBox values
        ValidatyComboBox.setItems(FXCollections.observableArrayList(
                "3 Days", "7 Days", "15 Days", "30 Days", "Unlimited"
        ));

        AvailabilityComboBox.setItems(FXCollections.observableArrayList(
                "App only", "Recharge only", "App and recharge"
        ));

        // Table columns
        packageNameColumn.setCellValueFactory(data -> data.getValue().packageNameProperty());
        dataAmountColumn.setCellValueFactory(data -> data.getValue().dataAmountProperty());
        validityColumn.setCellValueFactory(data -> data.getValue().validityProperty());
        priceColumn.setCellValueFactory(data -> data.getValue().priceProperty());
        availabilityColumn.setCellValueFactory(data -> data.getValue().availabilityProperty());
        offerEndsColumn.setCellValueFactory(data -> data.getValue().offerEndsProperty());

        TableViewC.setItems(packageList);
    }

    @FXML
    public void CreatePakageButtonOnAction(ActionEvent event) {

        String name = PakageNameTextField.getText();
        String data = DataAmountTextField.getText();
        String validity = ValidatyComboBox.getValue();
        String price = PriceTextField.getText();
        String availability = AvailabilityComboBox.getValue();
        LocalDate date = OfferEndsDP.getValue();

        // Simple Validation
        if (name.isEmpty() || data.isEmpty() || price.isEmpty()
                || validity == null || availability == null || date == null) {

            ShowMassageLebal.setText("Please fill all fields!");
            ShowMassageLebal.setStyle("-fx-text-fill: red;");
            return;
        }

        if (date.isBefore(LocalDate.now())) {
            ShowMassageLebal.setText("Date cannot be in past!");
            ShowMassageLebal.setStyle("-fx-text-fill: red;");
            return;
        }

        // Create object
        PackageData p = new PackageData(
                name,
                data + " GB",
                validity,
                "$" + price,
                availability,
                date
        );

        packageList.add(p);

        ShowMassageLebal.setText("Package Added Successfully!");
        ShowMassageLebal.setStyle("-fx-text-fill: green;");

        clearFields();
    }

    @FXML
    public void ResetButtonOnAction(ActionEvent event) {
        clearFields();
    }

    private void clearFields() {
        PakageNameTextField.clear();
        DataAmountTextField.clear();
        PriceTextField.clear();
        ValidatyComboBox.getSelectionModel().clearSelection();
        AvailabilityComboBox.getSelectionModel().clearSelection();
        OfferEndsDP.setValue(null);
    }
}
